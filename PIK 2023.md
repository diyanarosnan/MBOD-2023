## PUSAT INFORMASI KESIHATAN 2023
This is a walk through tutorial for the data sorting using dataset from PIK.

- [ ] Load library
- [ ] Calculate the age for rows with missing age
- [ ] Filter for your desired disease
- [ ] Remove missing age, sex and those who died
- [ ] Summarise the data

#### LOAD THE NECESSARY LIBRARIES
```
library(dplyr)
library(tidyr)
```

#### LOAD THE R DATA FILE FROM PIK
```
load("\\DIRECTORY REDACTED\\")
```
#### IDENTIFY THE ROWNAMES IN THE PIK DATASET WHERE ```patient_age_single``` IS EQUAL TO -1 (UNKNOWN).
```
target_indices <- which(Inp2023_burden$patient_age_single == "-1")
```

#### CREATE A SEPARATE DATAFRAME. EXTRACT THE WHOLE ROW FROM THE PIK DATASET WHERE THE ```patient_age_single``` IS EQUAL TO -1
```
df <- Inp2023_burden[target_indices, ]
```

```
df$dob_clean <- as.Date(sub(" .*", "", df$dob), format = "%Y/%m/%d")
```
```
as.date()           : converts character to date
sub()               : substitute
(" .*", "", df$dob) : (string after first space (" .*"), replace with nothing (""), extract from (df$dob)
                    : it will replace anything after the first space with nothing.
                    : BEFORE df$dob      = 2021/04/21 00:00:00
                    : AFTER df$dob_clean = 2021/04/21

as.date( 2021/04/21 , format = "%Y/%m/%d")
as.date ()          : convert character/string to date
format              : tells R how the date is structured
%Y/%m/%d            : year/month/date
```

#### EXTRACT THE YEAR FROM COLUMN ```dob_clean``` AND PLACE IT A NEW COLUMN CALLED ```year```
```
df$year <- as.numeric(format(df$dob_clean, "%Y"))
```
#### CALCULATE THE AGE AND UPDATE THE VALUES IN THE ```patient_age_single``` COLUMN
```
df$patient_age_single <- 2023 - df$year
```

#### EXTRACT AGE > 0 AND SUBSTITUTE THE AGE (-1) FROM THE ORIGINAL DATAFRAME TO THE NEWLY CALCULATED AGE.
```
df_clean <- df[df$patient_age_single >= 0 & !is.na(df$patient_age_single), ]
target_indices <- as.numeric(rownames(df_clean))
Inp2023_burden_clean <- Inp2023_burden
Inp2023_burden_clean$patient_age_single[target_indices] <- df_clean$patient_age_single
```
#### GENERATE A CSV
```
write.csv(Inp2023_burden_clean, "PIK 2023.csv")
```
#### IN THE DATAFRAME, THE ```patient_gender``` COLUMN HAVE FIVE RESULTS
```
unique(Inp2023_burden_clean$patient_gender)
> unique(Inp2023_burden_clean$patient_gender)
"LELAKI"  "PEREMPUAN"  "Tiada Maklumat"  "NOT AVAILABLE"  "RAGU"
```

#### FILTER FOR YOUR DESIRE DISEASE CODE (IN THIS TUTORIAL, I WANT TO OBSERVE COPD)
```
disease_data <- Inp2023_burden_clean %>% 
  filter(icd10_3d_code %in% c("J41", "J42", "J43", "J44")) %>% 
  filter(patient_gender %in% c("PEREMPUAN", "LELAKI")) %>%
  filter(patient_age_single >= 0, !disch_type_desc == "MATI")
```
#### CHANGE THE DISEASE CODE (AT THE SECOND ROW OF THE CODE ABOVE) USING THE ```filter()``` FUNCTION.
```
DIARRHOEAL DISEASE: A00, A02-A04, A06-A09
disease_data <- Inp2023_burden_clean %>% 
  filter(icd10_3d_code %in% c("A00", "A02", "A03", "A04", "A06", "A07", "A08", "A09")) %>% 
  filter(patient_gender %in% c("PEREMPUAN", "LELAKI")) %>%
  filter(patient_age_single >= 0, !disch_type_desc == "MATI")
```
```
FILTER FOR: RHEUMATIC HEART DISEASE: I01-I09
disease_data <- Inp2023_burden_clean %>% 
  filter(icd10_3d_code %in% c("I01", "I02", "I03", "I04", "I05", "I06", "I07", "I08", "I09")) %>% 
  filter(patient_gender %in% c("PEREMPUAN", "LELAKI")) %>%
  filter(patient_age_single >= 0, !disch_type_desc == "MATI")
```

>[!IMPORTANT]
> Make sure to put **double quotation mark("")** and **comma (,)** between your code.

>[!CAUTION]
> Entering values like **"I01-I09"** will not work in R .
> You have to write down one by one, **"I01"** , **"I02"** , **"I03"**

#### GENERATE A SUMMARY TABLE
```
copd_summary <- disease_data %>%
  filter(patient_gender %in% c("PEREMPUAN", "LELAKI")) %>%
  mutate(age_group = case_when(
    patient_age_single >= 0 & patient_age_single <= 4 ~ "0-5",
    patient_age_single >= 5 & patient_age_single <= 14 ~ "5-14",
    patient_age_single >= 15 & patient_age_single <= 29 ~ "15-29",
    patient_age_single >= 30 & patient_age_single <= 44 ~ "30-44",
    patient_age_single >= 45 & patient_age_single <= 59 ~ "45-59",
    patient_age_single >= 60 & patient_age_single <= 69 ~ "60-69",
    patient_age_single >= 70 & patient_age_single <= 79 ~ "70-79",
    patient_age_single >= 80 ~ "80+")) %>%
  group_by(age_group, patient_gender) %>%
  summarise(count = n(), .groups = 'drop')
```
```
> copd_summary
## A tibble: 16 × 3
##   age_group patient_gender count
##   <chr>     <chr>          <int>
## 1 0-5       LELAKI           478
##  2 0-5       PEREMPUAN        271
##  3 15-29     LELAKI            84
##  4 15-29     PEREMPUAN         56
##  5 30-44     LELAKI           791
##  6 30-44     PEREMPUAN        135
##  7 45-59     LELAKI          4904
##  8 45-59     PEREMPUAN        613
##  9 5-14      LELAKI           148
## 10 5-14      PEREMPUAN        117
## 11 60-69     LELAKI          9247
## 12 60-69     PEREMPUAN       1384
## 13 70-79     LELAKI          8127
## 14 70-79     PEREMPUAN       1866
## 15 80+       LELAKI          2798
## 16 80+       PEREMPUAN       1118
```
#### CHANGE THE STRUCTURE OF THE TABLE TO BECOME WIDER
```
copd_summary <- copd_summary %>%
  pivot_wider(names_from = patient_gender, values_from = count, values_fill = 0) %>%
  arrange(age_group)
```

```
> copd_summary
##  A tibble: 8 × 3
##  age_group LELAKI PEREMPUAN
##   <chr>      <int>     <int>
## 1 0-5          478       271
## 2 15-29         84        56
## 3 30-44        791       135
## 4 45-59       4904       613
## 5 5-14         148       117
## 6 60-69       9247      1384
## 7 70-79       8127      1866
## 8 80+         2798      1118
```
